CSRF is a vulnerability where the attacker induce a user to do actions that they do not intended to do.
#### Where to look for CSRF
This vulnerabillity requires of the following three conditions to be possible.
1. **An impotant action** that the attacker will want to induce. 
2. **A cookie session based handling** where the application relies on solely on sessions cookie to keep track sessions or validating user requests
3.  **No unpredictable request parameters**, meaning if the parameters utilized are guessable this represent an entry point for a CSRF

Where all of this conditions are met there occur CSRF.
- [[lab-no-defenses]]

#### Where to not look for CSRF
Basically to make the csrf work you will likely need the vulnerable site to store the cookie in the same place where's the backend functionality (I.E. PHP app). Thereby an arbitrary domain request the backend, will not include the cookies stored in the frontend due to SOP policy.
So in any application where backend and frontend are separated, CSRF will unlikely going to happen, unless it would be chained to other vulnerabillities.
- **Stored XSS** the frontend is vulnerable to cross site scripting, this will allow you, as an attacker, to craft a form for sending storing cookies from the victim's browser to the backend

### Defenses
Here is a list of the most common defenses.

- **CSRF tokens** - A CSRF token is a unique, secret, and unpredictable value that is generated by the server and included in the sensitive request.
    
- **SameSite cookies** - The most basic httponly cover and securized this vulnerabillity. 
	![[Pasted image 20250427111637.png]]
    Thanks to this header the cookies stored in frontend only can be sent from the frontend. Ez
- **Referer-based validation** - Some applications make use of the HTTP Referer header, verifying that its value match the domain header value

